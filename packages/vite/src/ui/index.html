<!doctype html>
<html class="dark">

<head>
    <meta charset="utf-8" />
    <title>Hono DI Explorer</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        root: '#09090b',
                        sub: '#18181b',
                        header: 'rgba(24, 24, 27, 0.9)',
                        border: '#27272a',
                        accent: '#6366f1',
                        'accent-hover': '#4f46e5',
                        card: '#1f1f22',
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    }
                }
            }
        }
    </script>
    <link href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-dark@4/dark.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.js"></script>
    <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #3f3f46;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #52525b;
        }

        .swal2-popup {
            background: #18181b !important;
            border: 1px solid #27272a !important;
            color: #e4e4e7 !important;
            border-radius: 0.75rem !important;
        }

        .swal2-title {
            color: #e4e4e7 !important;
            font-size: 1.125rem !important;
        }

        .swal2-styled.swal2-confirm {
            background-color: #6366f1 !important;
        }

        .swal2-styled.swal2-cancel {
            background-color: transparent !important;
            border: 1px solid #27272a !important;
            color: #a1a1aa !important;
        }
    </style>
</head>

<body class="bg-root text-neutral-200 text-[13px] h-screen flex flex-col overflow-hidden font-sans">

    <div class="flex flex-1 overflow-hidden">
        <!-- Sidebar -->
        <div class="w-[60px] bg-sub border-r border-border flex flex-col items-center pt-2.5 gap-2.5 z-20">
            <div class="w-10 h-10 rounded-lg flex items-center justify-center cursor-pointer text-neutral-400 hover:bg-white/5 hover:text-white transition-all relative group active-nav"
                onclick="switchTab('files', this)">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z" />
                    <polyline points="13 2 13 9 20 9" />
                </svg>
                <div
                    class="absolute left-[50px] bg-black text-white px-2 py-1 rounded text-[11px] opacity-0 group-hover:opacity-100 pointer-events-none transition-opacity whitespace-nowrap z-50">
                    Files</div>
            </div>
            <div class="w-10 h-10 rounded-lg flex items-center justify-center cursor-pointer text-neutral-400 hover:bg-white/5 hover:text-white transition-all relative group"
                onclick="switchTab('graph', this)">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="18" cy="5" r="3" />
                    <circle cx="6" cy="12" r="3" />
                    <circle cx="18" cy="19" r="3" />
                    <line x1="8.59" y1="13.51" x2="15.42" y2="17.49" />
                    <line x1="15.41" y1="6.51" x2="8.59" y2="10.49" />
                </svg>
                <div
                    class="absolute left-[50px] bg-black text-white px-2 py-1 rounded text-[11px] opacity-0 group-hover:opacity-100 pointer-events-none transition-opacity whitespace-nowrap z-50">
                    Graph</div>
            </div>
            <div class="w-10 h-10 rounded-lg flex items-center justify-center cursor-pointer text-neutral-400 hover:bg-white/5 hover:text-white transition-all relative group"
                onclick="switchTab('dashboard', this)">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="7" height="9" />
                    <rect x="14" y="3" width="7" height="5" />
                    <rect x="14" y="12" width="7" height="9" />
                    <rect x="3" y="16" width="7" height="5" />
                </svg>
                <div
                    class="absolute left-[50px] bg-black text-white px-2 py-1 rounded text-[11px] opacity-0 group-hover:opacity-100 pointer-events-none transition-opacity whitespace-nowrap z-50">
                    Overview</div>
            </div>
        </div>

        <div class="flex-1 flex flex-col overflow-hidden relative">
            <!-- FILE VIEW -->
            <div id="view-files" class="flex flex-col w-full h-full">
                <header
                    class="bg-header backdrop-blur-md px-5 h-[52px] flex items-center justify-between border-b border-border z-10">
                    <div class="flex items-center gap-2 font-semibold text-sm tracking-tight">
                        <div class="w-2 h-2 bg-accent rounded-full shadow-[0_0_12px_var(--accent)]"></div>PROJECT
                        EXPLORER
                    </div>
                    <div class="flex items-center gap-3">
                        <div class="relative flex items-center">
                            <svg class="absolute left-2.5 text-neutral-400 w-3.5 h-3.5 pointer-events-none"
                                viewBox="0 0 24 24">
                                <path d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"
                                    stroke-width="2" stroke="currentColor" fill="none" />
                            </svg>
                            <input id="q"
                                class="bg-sub border border-border text-neutral-200 rounded-md py-1.5 pl-8 pr-3 w-[220px] text-xs transition-all focus:border-accent focus:w-[280px] focus:outline-none placeholder:text-neutral-500"
                                placeholder="Search files..." autocomplete="off">
                        </div>
                        <button
                            class="bg-gradient-to-br from-accent to-accent-hover text-white px-4 py-1.5 rounded-md cursor-pointer text-xs font-medium flex items-center gap-1.5 transition-all shadow-sm hover:-translate-y-px hover:shadow-lg active:translate-y-0"
                            onclick="openGenerator()">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z" />
                            </svg> Generate
                        </button>
                    </div>
                </header>
                <div id="file-tree" class="flex-1 overflow-y-auto py-3"></div>
            </div>

            <!-- GRAPH VIEW -->
            <div id="view-graph" class="hidden flex-col w-full h-full">
                <header
                    class="bg-header backdrop-blur-md px-5 h-[52px] flex items-center justify-between border-b border-border z-10">
                    <div class="flex items-center gap-2 font-semibold text-sm tracking-tight">
                        <div class="w-2 h-2 bg-accent rounded-full shadow-[0_0_12px_var(--accent)]"></div>DEPENDENCY
                        GRAPH
                    </div>
                    <button
                        class="bg-gradient-to-br from-accent to-accent-hover text-white px-4 py-1.5 rounded-md cursor-pointer text-xs font-medium flex items-center gap-1.5 transition-all shadow-sm hover:-translate-y-px"
                        onclick="loadGraph()">Refresh Graph</button>
                </header>
                <div id="mynetwork" class="flex-1 w-full h-full bg-[#111]"></div>
                <div class="absolute bottom-5 right-5 bg-sub p-2 rounded-lg border border-border flex gap-2 shadow-lg">
                    <div class="text-[11px] text-neutral-400">Scroll to Zoom â€¢ Drag to Pan</div>
                </div>
            </div>

            <!-- DASHBOARD VIEW -->
            <div id="view-dashboard" class="hidden flex-col w-full h-full">
                <div class="p-8 overflow-y-auto">
                    <div class="mb-8">
                        <div class="text-2xl font-semibold mb-2">Project Overview</div>
                        <div class="text-neutral-400 text-sm">Real-time statistics of your DI container</div>
                    </div>
                    <div id="stats-grid" class="grid grid-cols-[repeat(auto-fill,minmax(200px,1fr))] gap-5 mb-10">
                        <!-- Populated by JS -->
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- Context Menu -->
    <div id="context-menu"
        class="fixed bg-sub/95 backdrop-blur-md border border-border shadow-2xl rounded-lg p-1.5 hidden z-50 min-w-[180px]">
        <div class="px-3 py-2 cursor-pointer text-neutral-200 rounded flex items-center gap-2.5 text-[13px] font-medium hover:bg-accent hover:text-white transition-colors"
            onclick="promptCreate('file')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="opacity-80">
                <path
                    d="M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
            </svg> New File
        </div>
        <div class="px-3 py-2 cursor-pointer text-neutral-200 rounded flex items-center gap-2.5 text-[13px] font-medium hover:bg-accent hover:text-white transition-colors"
            onclick="promptCreate('dir')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="opacity-80">
                <path
                    d="M10 4H6a2 2 0 00-2 2v12a2 2 0 002 2h12a2 2 0 002-2v-8a2 2 0 00-2-2h-7.586a1 1 0 01-.707-.293l-1.414-1.414A1 1 0 0010 4z" />
            </svg> New Folder
        </div>
        <div class="px-3 py-2 cursor-pointer text-neutral-200 rounded flex items-center gap-2.5 text-[13px] font-medium hover:bg-accent hover:text-white transition-colors"
            onclick="openGenerator()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="opacity-80">
                <path d="M13 10V3L4 14h7v7l9-11h-7z" />
            </svg> Generate...
        </div>
        <div class="h-px bg-border my-1"></div>
        <div class="px-3 py-2 cursor-pointer text-neutral-200 rounded flex items-center gap-2.5 text-[13px] font-medium hover:bg-accent hover:text-white transition-colors"
            onclick="promptRename()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="opacity-80">
                <path
                    d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />
            </svg> Rename
        </div>
        <div class="px-3 py-2 cursor-pointer text-red-500 rounded flex items-center gap-2.5 text-[13px] font-medium hover:bg-red-600 hover:text-white transition-colors"
            onclick="promptDelete()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="opacity-80">
                <path
                    d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
            </svg> Delete
        </div>
    </div>

    <script type="module">
        /* --- Global State --- */
        let fullTree = null;
        let expandedPaths = new Set(['']);
        let selectedPath = null;
        let contextNode = null;
        let network = null;

        const app = document.getElementById('file-tree');
        const qEl = document.getElementById('q');
        const ctxMenu = document.getElementById('context-menu');

        // Active Nav State helper
        const updateActiveNav = (el) => {
            document.querySelectorAll('.active-nav').forEach(e => {
                e.classList.remove('active-nav', 'bg-accent', 'text-white', 'shadow-lg', 'shadow-indigo-500/40');
                e.classList.add('text-neutral-400');
            });
            el.classList.add('active-nav', 'bg-accent', 'text-white', 'shadow-lg', 'shadow-indigo-500/40');
            el.classList.remove('text-neutral-400', 'hover:bg-white/5');
        };

        /* --- Navigation --- */
        window.switchTab = (tab, navEl) => {
            ['files', 'graph', 'dashboard'].forEach(t => {
                const el = document.getElementById('view-' + t);
                if (t === tab) {
                    el.classList.remove('hidden');
                    el.classList.add('flex');
                } else {
                    el.classList.add('hidden');
                    el.classList.remove('flex');
                }
            });
            if (navEl) updateActiveNav(navEl);

            if (tab === 'graph') loadGraph();
            if (tab === 'dashboard') loadStats();
        };

        /* --- API --- */
        async function callApi(endpoint, body) {
            const r = await fetch('/__hono_di/api/' + endpoint, { method: 'POST', body: JSON.stringify(body) });
            const res = await r.json();
            if (!r.ok) throw new Error(res.error || 'Unknown error');
            return res;
        }

        /* --- Stats & Dashboard --- */
        async function loadStats() {
            try {
                const res = await fetch('/__hono_di/api/stats').then(r => r.json());
                const grid = document.getElementById('stats-grid');
                grid.innerHTML = '';

                const LABELS = {
                    modules: 'Modules', controllers: 'Controllers', services: 'Services',
                    files: 'Total Files', dirs: 'Directories'
                };

                Object.entries(res).forEach(([key, val]) => {
                    const card = document.createElement('div');
                    card.className = 'bg-card border border-border rounded-xl p-5 flex flex-col gap-2 relative overflow-hidden group';
                    card.innerHTML = `
                        <div class="absolute top-0 left-0 w-full h-0.5 bg-accent opacity-50 group-hover:opacity-100 transition-opacity"></div>
                        <span class="text-neutral-400 text-xs font-medium uppercase tracking-wider">${LABELS[key] || key}</span>
                        <span class="text-3xl font-bold text-white tracking-tight">${val}</span>
                        <div class="absolute right-5 bottom-5 opacity-10 text-current w-12 h-12">
                             <svg width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                ${key === 'modules' ? '<path d="M12 2l10 6.5v7L12 22 2 15.5v-7L12 2z"/>' :
                            key === 'controllers' ? '<path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"/>' :
                                '<path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>'}
                             </svg>
                        </div>
                    `;
                    grid.appendChild(card);
                });
            } catch (e) { console.error(e); }
        }

        /* --- Graph Logic --- */
        async function loadGraph() {
            try {
                const data = await fetch('/__hono_di/api/graph').then(r => r.json());
                const container = document.getElementById('mynetwork');

                const nodes = new vis.DataSet(data.nodes);
                const edges = new vis.DataSet(data.edges);

                const options = {
                    nodes: {
                        shape: 'dot', size: 16,
                        font: { color: '#ffffff', face: 'Inter' },
                        borderWidth: 2,
                        color: { background: '#202020', border: '#6366f1', highlight: { background: '#6366f1', border: '#fff' } }
                    },
                    edges: {
                        width: 1, color: { color: '#444', highlight: '#6366f1' },
                        arrows: 'to', smooth: { type: 'continuous' }
                    },
                    physics: {
                        stabilization: false,
                        barnesHut: { gravitationalConstant: -2000, springCreate: 0.005 }
                    },
                    layout: { randomSeed: 2 }
                };

                network = new vis.Network(container, { nodes, edges }, options);
            } catch (e) { console.error(e); }
        }

        /* --- Tree View Logic --- */
        const ICONS = {
            chevron: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 5l7 7-7 7"/></svg>',
            folder: '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/></svg>',
            file: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"/><polyline points="13 2 13 9 20 9"/></svg>'
        };

        async function fetchTree() {
            try {
                const r = await fetch('/__hono_di/api/tree');
                fullTree = (await r.json()).tree;
                draw();
            } catch (e) { console.error(e); }
        }

        function filterTree(node, query) {
            if (!query) return node;
            const matchesSelf = node.name.toLowerCase().includes(query.toLowerCase());
            if (node.type === 'file') return matchesSelf ? node : null;
            const filteredChildren = (node.children || []).map(c => filterTree(c, query)).filter(Boolean);
            if (matchesSelf || filteredChildren.length > 0) {
                if (query) expandedPaths.add(node.path);
                return { ...node, children: filteredChildren };
            }
            return null;
        }

        function renderNode(node, depth = 0) {
            const isDir = node.type === 'dir';
            const isExpanded = expandedPaths.has(node.path);
            const isSelected = selectedPath === node.path;
            const li = document.createElement('li');
            const row = document.createElement('div');

            // Tailwind classes for row
            const baseClasses = "flex items-center px-4 min-h-[26px] cursor-pointer border-l-2 border-transparent transition-colors relative group";
            const hoverClasses = "hover:bg-[#27272a]";
            const selectedClasses = "bg-[#2e2e32] border-l-accent";

            row.className = `${baseClasses} ${isSelected ? selectedClasses : hoverClasses}`;
            row.style.paddingLeft = (16 + depth * 14) + 'px';

            row.onclick = () => {
                selectedPath = node.path;
                if (isDir) { isExpanded ? expandedPaths.delete(node.path) : expandedPaths.add(node.path); }
                draw();
            };
            row.oncontextmenu = (e) => {
                e.preventDefault(); e.stopPropagation();
                selectedPath = node.path; contextNode = node;
                showContextMenu(e.clientX, e.clientY); draw();
            };

            let icon = isDir ?
                `<div class="text-neutral-400/70 w-3.5 h-3.5 mr-0.5 transition-transform ${isExpanded ? 'rotate-90' : ''}">${ICONS.chevron}</div><div class="text-yellow-500 w-4 h-4">${ICONS.folder}</div>` :
                `<div style="width:14px; display:inline-block"></div><div class="text-blue-400 w-4 h-4">${ICONS.file}</div>`;

            row.innerHTML = `${icon}<span class="ml-2 font-mono text-[12.5px] font-normal">${node.name}</span>`;
            li.appendChild(row);
            if (isDir && isExpanded && node.children) {
                const ul = document.createElement('ul');
                node.children.forEach(c => ul.appendChild(renderNode(c, depth + 1)));
                li.appendChild(ul);
            }
            return li;
        }

        function draw() {
            app.innerHTML = '';
            if (!fullTree) return;
            const treeToRender = filterTree(fullTree, qEl.value.trim());
            if (treeToRender) { const ul = document.createElement('ul'); ul.appendChild(renderNode(treeToRender)); app.appendChild(ul); }
        }

        /* --- Context Menu --- */
        function showContextMenu(x, y) {
            ctxMenu.classList.remove('hidden');
            ctxMenu.animate([{ opacity: 0, transform: 'scale(0.95)' }, { opacity: 1, transform: 'scale(1)' }], { duration: 100, fill: 'forwards' });
            const w = window.innerWidth, h = window.innerHeight;
            ctxMenu.style.left = (x + ctxMenu.offsetWidth > w ? w - ctxMenu.offsetWidth : x) + 'px';
            ctxMenu.style.top = (y + ctxMenu.offsetHeight > h ? h - ctxMenu.offsetHeight : y) + 'px';
        }
        document.addEventListener('click', () => ctxMenu.classList.add('hidden'));

        /* --- Actions (SweetAlert2) --- */
        window.promptCreate = async (type) => {
            const isDir = type === 'dir';
            const node = contextNode || fullTree;
            const base = node.type === 'dir' ? node.path : node.path.split('/').slice(0, -1).join('/');

            const { value: name } = await Swal.fire({
                title: isDir ? 'New Folder' : 'New File',
                input: 'text',
                inputLabel: `Inside: /${base}`,
                inputPlaceholder: isDir ? 'folder_name' : 'file.ts',
                showCancelButton: true
            });

            if (name) {
                const fullPath = base ? `${base}/${name}` : name;
                try {
                    await callApi(isDir ? 'dir/create' : 'file/create', { path: fullPath });
                    const toast = Swal.mixin({ toast: true, position: 'bottom-end', showConfirmButton: false, timer: 3000 });
                    toast.fire({ icon: 'success', title: 'Created successfully' });
                } catch (e) { Swal.fire('Error', e.message, 'error'); }
            }
        };

        window.promptRename = async () => {
            const node = contextNode || (selectedPath ? { path: selectedPath, name: selectedPath.split('/').pop() } : null);
            if (!node) return;

            const { value: newName } = await Swal.fire({
                title: 'Rename',
                input: 'text',
                inputValue: node.name,
                showCancelButton: true
            });

            if (newName && newName !== node.name) {
                try {
                    const oldPath = node.path;
                    const base = oldPath.split('/').slice(0, -1).join('/');
                    const newPath = base ? `${base}/${newName}` : newName;

                    await callApi('move', { from: oldPath, to: newPath });
                    fetchTree();
                } catch (e) { Swal.fire('Error', e.message, 'error'); }
            }
        };

        window.promptDelete = async () => {
            const node = contextNode || (selectedPath ? { path: selectedPath } : null);
            if (!node) return;

            const result = await Swal.fire({
                title: 'Delete?',
                text: `Are you sure you want to delete "${node.path}"?`,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#ef4444',
                confirmButtonText: 'Delete'
            });

            if (result.isConfirmed) {
                try {
                    await callApi('delete', { path: node.path });
                    Swal.fire({ title: 'Deleted!', icon: 'success', timer: 1000, showConfirmButton: false });
                    if (selectedPath === node.path) { selectedPath = null; contextNode = null; }
                    fetchTree();
                } catch (e) { Swal.fire('Error', e.message, 'error'); }
            }
        };

        /* --- Generator Wizard --- */
        window.openGenerator = async () => {
            const node = contextNode || fullTree;
            let initialPath = node ? (node.type === 'dir' ? node.path : node.path.split('/').slice(0, -1).join('/')) : '';
            if (!initialPath) initialPath = 'src';

            const types = ['module', 'controller', 'service', 'provider', 'class', 'interface', 'pipe', 'guard', 'filter', 'interceptor', 'decorator'];
            const typeChecks = types.map(t => `
        <label class="bg-root border border-border rounded-md p-2.5 cursor-pointer flex items-center gap-2 transition-all hover:border-accent hover:bg-indigo-500/5 select-none">
            <input type="checkbox" class="type-cb accent-accent w-3.5 h-3.5 m-0" value="${t}" ${t === 'controller' || t === 'service' ? 'checked' : ''}>
            <span class="text-xs font-medium capitalize">${t}</span>
        </label>
            `).join('');

            const { value: formValues } = await Swal.fire({
                title: 'Generate Resource',
                width: 600,
                html: `
        <div class="flex flex-col gap-4 text-left">
            <div>
                <label class="text-xs font-medium text-neutral-400 uppercase tracking-wide mb-1.5 block">Resource Types</label>
                <div class="grid grid-cols-3 gap-2">${typeChecks}</div>
            </div>
            <div>
                <label class="text-xs font-medium text-neutral-400 uppercase tracking-wide mb-1.5 block">Name</label>
                <input id="swal-name" class="bg-root border border-border text-white p-2.5 rounded-md w-full font-mono text-[13px] focus:border-accent focus:outline-none" placeholder="e.g. auth/user" autocomplete="off">
            </div>
            <div>
                <label class="text-xs font-medium text-neutral-400 uppercase tracking-wide mb-1.5 block">Target Path</label>
                <input id="swal-path" class="bg-root border border-border text-white p-2.5 rounded-md w-full font-mono text-[13px] focus:border-accent focus:outline-none" value="${initialPath}" autocomplete="off">
            </div>
            <div class="flex flex-wrap gap-4 mt-2">
                <label class="flex items-center gap-2 cursor-pointer text-[13px] text-neutral-200"><input type="checkbox" id="swal-flat" class="accent-accent"> Flat <span class="text-[11px] text-neutral-400">(No sub-folder)</span></label>
                <label class="flex items-center gap-2 cursor-pointer text-[13px] text-neutral-200"><input type="checkbox" id="swal-spec" checked class="accent-accent"> Spec</label>
                <label class="flex items-center gap-2 cursor-pointer text-[13px] text-neutral-200"><input type="checkbox" id="swal-skip-import" class="accent-accent"> Skip Import</label>
                <label class="flex items-center gap-2 cursor-pointer text-[13px] text-neutral-200"><input type="checkbox" id="swal-force" class="accent-accent"> Force</label>
                <label class="flex items-center gap-2 cursor-pointer text-[13px] text-amber-400"><input type="checkbox" id="swal-dry" class="accent-amber-400"> Dry Run</label>
            </div>
        </div>
        `,
                focusConfirm: false,
                showCancelButton: true,
                confirmButtonText: 'Generate',
                preConfirm: () => {
                    return {
                        type: Array.from(document.querySelectorAll('.type-cb:checked')).map(cb => cb.value),
                        name: document.getElementById('swal-name').value,
                        path: document.getElementById('swal-path').value,
                        flat: document.getElementById('swal-flat').checked,
                        spec: document.getElementById('swal-spec').checked,
                        skipImport: document.getElementById('swal-skip-import').checked,
                        force: document.getElementById('swal-force').checked,
                        dryRun: document.getElementById('swal-dry').checked
                    }
                }
            });

            if (formValues) {
                if (!formValues.name) return Swal.fire('Error', 'Name is required', 'error');
                try {
                    const res = await callApi('generate', formValues);
                    Swal.fire({
                        title: res.success ? 'Success' : 'Partial',
                        text: `Generated ${res.operations.length} files`,
                        icon: res.success ? 'success' : 'warning'
                    });
                    // Refresh tree
                    fetchTree();
                } catch (e) { Swal.fire('Error', e.message, 'error'); }
            }
        }

        /* --- Init --- */
        if (import.meta.hot) { import.meta.hot.on('hono_di:update', d => { fullTree = d.tree; draw(); }); }
        qEl.oninput = () => draw();
        fetchTree();
        // Init active nav
        updateActiveNav(document.querySelector('.nav-item.active') || document.querySelector('.nav-item'));
    </script>
</body>

</html>